version: '3'
services:
  web:
    build:
      context: .
      args:
        DEVELOPMENT_MODE: 'true'
        RUN_BUILD: 'false'
    depends_on:
      - mysql
    environment:
      ASSETS_S3_BUCKET: '<%= config.asset_bucket %>'
      ASSETS_ENV: development
      ASSETS_CLEANUP: 'false'
      AWS_ACCESS_KEY_ID:
      AWS_SECRET_ACCESS_KEY:
      DATABASE_NAME: <%= config.name %>
      DATABASE_USER: <%= config.name %>
      DATABASE_PASSWORD: <%= config.name %>
      DATABASE_HOST: mysql
      RUN_BUILD: # get from host env
    expose:
      - 80
      - 443
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - .:/app

  mysql:
    image: quay.io/continuouspipe/mysql5.7:stable
    environment:
      MYSQL_ROOT_PASSWORD: <%= config.tmp.mysql_root_password %>
      MYSQL_DATABASE: <%= config.name %>
      MYSQL_USER: <%= config.name %>
      MYSQL_PASSWORD: <%= config.name %>
